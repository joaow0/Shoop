{% extends 'loja/main.html' %}
{% load static %}
{% load format_tags %}

{% block content %}
<div class="container py-4">
    <h1 class="mb-4 fw-bold">üîç Resultados para "{{ query }}"</h1>

    <div class="row">
        <!-- üîß Coluna lateral de filtros -->
        <div class="col-md-3 mb-4">
            <div class="filter-box border rounded p-3">
                <h5 class="fw-bold mb-3">Filtrar Resultados</h5>
                <form method="get">
                    <input type="hidden" name="q" value="{{ query }}">

                    <div class="mb-3">
                        <label class="form-label">Pre√ßo M√≠nimo</label>
                        <input type="number" step="0.01" name="preco_min" class="form-control"
                            placeholder="0.00" value="{{ preco_min|default:'' }}">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Pre√ßo M√°ximo</label>
                        <input type="number" step="0.01" name="preco_max" class="form-control"
                            placeholder="9999.99" value="{{ preco_max|default:'' }}">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Ordenar Por</label>
                        <select name="ordenar" class="form-select">
                            <option value="">Padr√£o</option>
                            <option value="menor_preco" {% if ordenar == 'menor_preco' %}selected{% endif %}>Menor Pre√ßo</option>
                            <option value="maior_preco" {% if ordenar == 'maior_preco' %}selected{% endif %}>Maior Pre√ßo</option>
                            <option value="a_z" {% if ordenar == 'a_z' %}selected{% endif %}>A-Z</option>
                            <option value="z_a" {% if ordenar == 'z_a' %}selected{% endif %}>Z-A</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary w-100">Filtrar üîé</button>
                </form>
            </div>
        </div>

        <!-- üõçÔ∏è Lista de Produtos -->
        <div class="col-md-9">
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                {% for produto in produtos %}
                    <div class="col fade-in">
                        <a href="{% url 'produto' produto.id %}" style="text-decoration: none; color: inherit;">
                            <div class="card h-100 border-0">
                                <img src="{{ produto.imagemURL }}" class="card-img-top" alt="{{ produto.nome }}"
                                    style="object-fit: cover; height: 220px;">
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title fw-semibold fs-4">{{ produto.nome }}</h5>
                                    <p class="card-text text-muted mb-3">{{ produto.descricao }}</p>
                                    <div class="mt-auto d-flex justify-content-between align-items-center">
                                        <h4 class="text-success mb-0">
                                            <strong>{{ produto.pre√ßo|moeda_br }}</strong>
                                        </h4>
                                        <button 
                                            data-product="{{ produto.id }}" 
                                            data-action="add" 
                                            class="btn btn-outline-primary btn-sm update-cart">
                                            üõí Adicionar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                {% empty %}
                    <div class="col-12">
                        <p class="text-muted">Nenhum produto encontrado para "<strong>{{ query }}</strong>".</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/carrinho.js' %}" defer></script>
{% endblock %}
