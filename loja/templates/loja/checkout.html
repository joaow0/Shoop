{% extends 'loja/main.html' %}
{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/checkout.css' %}">
{% endblock %}

{% block content %}

<div class="container my-4">
    <div class="row gap-4">

        <!-- FORMUL√ÅRIO -->
        <div class="col-lg-7 col-md-12">
            <div class="box-element">
                <form id="formulario">
                    {% csrf_token %}

                    <h5 class="mb-3">üßë‚Äçüíº Informa√ß√µes Pessoais</h5>

                    <div class="form-field mb-3">
                        <label for="nome" class="form-label">Nome completo</label>
                        <input required class="form-control" type="text" name="nome" id="nome" placeholder="Digite seu nome">
                    </div>
                    <div class="form-field mb-4">
                        <label for="email" class="form-label">E-mail</label>
                        <input required class="form-control" type="email" name="email" id="email" placeholder="seuemail@exemplo.com">
                    </div>

                    {% if pedido.envio %}
                    <h5 class="mb-3">üöö Endere√ßo de Entrega</h5>

                    <div class="form-field mb-3">
                        <label for="endereco" class="form-label">Endere√ßo</label>
                        <input class="form-control" type="text" name="address" id="endereco" placeholder="Rua, n√∫mero e complemento">
                    </div>
                    <div class="form-field mb-3">
                        <label for="cidade" class="form-label">Cidade</label>
                        <input class="form-control" type="text" name="city" id="cidade" placeholder="Ex: S√£o Paulo">
                    </div>
                    <div class="form-field mb-3">
                        <label for="estado" class="form-label">Estado</label>
                        <input class="form-control" type="text" name="state" id="estado" placeholder="Ex: SP">
                    </div>
                    <div class="form-field mb-3">
                        <label for="cep" class="form-label">CEP</label>
                        <input class="form-control" type="text" name="zipcode" id="cep" placeholder="00000-000">
                    </div>
                    <div class="form-field mb-4">
                        <label for="pais" class="form-label">Pa√≠s</label>
                        <input class="form-control" type="text" name="country" id="pais" placeholder="Ex: Brasil">
                    </div>
                    {% endif %}

                    <hr>
                    <input id="form-button" class="btn btn-success w-100" type="submit" value="Continuar para pagamento">
                </form>
            </div>

            <br>

            <div class="box-element hidden" id="payment-info">
                <p><small>Op√ß√µes de pagamento via PayPal</small></p>
                <div id="paypal-button-container"></div>
            </div>
        </div>

        <!-- RESUMO DO PEDIDO -->
        <div class="col-lg-4 col-md-12">
            <div class="box-element">
                <a class="btn btn-outline-dark btn-sm mb-2" href="{% url 'carrinho' %}">&#x2190; Voltar ao carrinho</a>

                <h5>Resumo do Pedido</h5>
                <hr>

                {% for item in itens %}
                <div class="d-flex align-items-center mb-3" style="gap: 10px;">
                    <img src="{{ item.produto.imagemURL }}" class="rounded"
                         style="width: 70px; height: 70px; object-fit: cover;">
                    <div class="flex-grow-1">
                        <h6 class="mb-1">{{ item.produto.nome }}</h6>
                        <small>{{ item.quantidade }} x R${{ item.produto.pre√ßo|floatformat:2 }}</small>
                    </div>
                    <div>
                        <strong>R${{ item.get_total|floatformat:2 }}</strong>
                    </div>
                </div>
                {% endfor %}

                <hr>

                <div class="d-flex justify-content-between">
                    <span>Itens:</span>
                    <strong>{{ pedido.get_cart_items }}</strong>
                </div>

                <div class="d-flex justify-content-between">
                    <span>Total:</span>
                    <strong class="text-success">R${{ pedido.get_cart_total|floatformat:2 }}</strong>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- PayPal SDK -->
<script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD"></script>

{% endblock %}

{% block scripts %}
<script src="{% static 'js/checkout.js' %}" defer></script>
{% endblock %}
